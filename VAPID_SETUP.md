# üîë VAPID Keys Setup Guide

To fix the `InvalidCharacterError` and enable push notifications, you need to generate and configure VAPID keys.

## üöÄ Quick Setup (2 minutes)

### Step 1: Generate VAPID Keys

```bash
# Install web-push globally (if not already installed)
npm install -g web-push

# Generate VAPID key pair
npx web-push generate-vapid-keys
```

This will output something like:
```
=======================================

Public Key:
BEl62iUYgUivxIkv69yViEuiBIa6LnRC2RNCOp1SDbsZhC3G...

Private Key:
VzXNgR6v6gTl7hNGdvYjlbR-LKVMkFCN5gY4pjlQ...

=======================================
```

### Step 2: Add to Environment Variables

Create or update your `.env.local` file:

```bash
# Push Notifications VAPID Keys
NEXT_PUBLIC_VAPID_PUBLIC_KEY=BEl62iUYgUivxIkv69yViEuiBIa6LnRC2RNCOp1SDbsZhC3G...
VAPID_PRIVATE_KEY=VzXNgR6v6gTl7hNGdvYjlbR-LKVMkFCN5gY4pjlQ...
```

**Important Notes:**
- ‚úÖ `NEXT_PUBLIC_VAPID_PUBLIC_KEY` starts with `NEXT_PUBLIC_` (visible to frontend)
- ‚úÖ `VAPID_PRIVATE_KEY` does NOT have `NEXT_PUBLIC_` (backend only)
- ‚úÖ Copy the FULL keys including all characters
- ‚úÖ No quotes around the values

### Step 3: Restart Development Server

```bash
# Stop your current server (Ctrl+C)
# Start again
npm run dev
```

### Step 4: Test Push Notifications

1. Go to `/notifications` page
2. Click "Enable Notifications"
3. Should now work without the `InvalidCharacterError`

## üîß Troubleshooting

### Still getting `InvalidCharacterError`?

1. **Check the key format**: VAPID public keys should be ~88 characters long and contain only letters, numbers, '+', '/', and '=' characters.

2. **Verify environment variable**: Make sure it's exactly `NEXT_PUBLIC_VAPID_PUBLIC_KEY` (case-sensitive).

3. **Check for extra characters**: No spaces, quotes, or newlines in the key.

4. **Restart the server**: Environment variables require a restart to take effect.

### Test your VAPID key:

```javascript
// In browser console, test the key conversion:
const key = 'YOUR_VAPID_PUBLIC_KEY_HERE';
const padding = '='.repeat((4 - key.length % 4) % 4);
const base64 = (key + padding).replace(/-/g, '+').replace(/_/g, '/');
try {
  window.atob(base64);
  console.log('‚úÖ VAPID key is valid');
} catch (e) {
  console.error('‚ùå VAPID key is invalid:', e);
}
```

## üîí Security Notes

- **Never commit** your private key to version control
- **Keep** your private key secret (backend only)
- **The public key** can be safely exposed to the frontend
- **Use different keys** for development and production

## üìö Next Steps

Once VAPID keys are configured:

1. ‚úÖ Push notifications will work locally
2. ‚ö†Ô∏è You still need to implement the backend endpoints:
   - `POST /api/push/subscribe`
   - `POST /api/push/unsubscribe`
   - Push sending logic when messages are created

Check `PUSH_NOTIFICATIONS_README.md` for complete backend integration guide.

---

**Still having issues?** Make sure your generated VAPID keys follow the base64url format and are exactly as generated by the web-push library.